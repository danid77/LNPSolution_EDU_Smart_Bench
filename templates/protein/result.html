{% extends "base.html" %}
{% block style %}
#summary-bar {
  font-size: 1.1rem;
  background: #f0f0f0;
  padding: 10px 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.summary-section .card {
    height: 100%;
}
  
.summary-section .card-header {
font-size: 1.1rem;
font-weight: 600;
}

#summary-3dviewer {
    position: relative;   /* canvasê°€ íŠ€ì–´ë‚˜ì˜¤ì§€ ì•Šë„ë¡ */
    z-index: 0;           /* í—¤ë”ë³´ë‹¤ ì•„ë˜ë¡œ */
    height: 400px;
    width: 100%;
    overflow: hidden;     /* í˜¹ì‹œë¼ë„ canvasê°€ ë„˜ì¹˜ë©´ ìˆ¨ê¸°ê¸° */
}

.card-body {
    position: relative;   /* ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ ì•ˆì •í™” */
}

.btn-lnp {
  background-color: rgb(149, 189, 69) !important;
  border: none;
  color: white;  /* ê¸°ë³¸ì€ í°ìƒ‰ */
  transition: background-color 0.3s, transform 0.2s, color 0.2s;
}

.btn-lnp.active {
  color: black !important;  /* í™œì„±í™” ì‹œ ê²€ì •ìƒ‰ìœ¼ë¡œ */
}
{% endblock %}
{% block content %}

<div class="container mt-5">
  <h2 class="text-primary mb-4">ğŸ§¬ Protein Structure Generate 3D Virtual Results</h2>

  <!-- âœ… summary-section + row ìŠ¤íƒ€ì¼ ì ìš© -->
  <div class="summary-section row mb-5">
    
    <!-- ğŸ”¸ 3Dmol.js ë·°ì–´ ì¹´ë“œ -->
    <div class="col-md-10 mx-auto">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light">
          <!-- ğŸ”¹ Pose ì„ íƒ -->
          <div class="d-flex flex-column flex-md-row gap-3 align-items-start justify-content-between">
    
            <!-- ğŸ”¹ êµ¬ì¡° ì„ íƒ ë²„íŠ¼ë“¤ -->
            <div class="d-flex flex-wrap gap-2">
              <label class="form-label fw-bold me-2">Structure Select:</label>
              <button class="btn btn-sm btn-lnp" data-pose="origin" onclick="togglePose(this)">Origin</button>
              <button class="btn btn-sm btn-lnp" data-pose="openfold" onclick="togglePose(this)">OpenFold2</button>
              <button class="btn btn-sm btn-lnp" data-pose="af2" onclick="togglePose(this)">AlphaFold2</button>
              <button class="btn btn-sm btn-lnp" data-pose="esmfold" onclick="togglePose(this)">ESMFold</button>
              <button class="btn btn-sm btn-lnp" data-pose="boltz" onclick="togglePose(this)">Boltz</button>
              <button class="btn btn-sm btn-lnp" data-pose="chai" onclick="togglePose(this)">Chai</button>
            </div>
        
            <!-- ğŸ”¹ ìŠ¤íƒ€ì¼ ë²„íŠ¼ -->
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-sm btn-outline-dark" onclick="setStyleStick()">Stick</button>
              <button class="btn btn-sm btn-outline-dark" onclick="resetStyleCartoon()">Cartoon</button>
              <button class="btn btn-sm btn-outline-dark" onclick="toggleSpin()">Spin</button>
              <button class="btn btn-sm btn-outline-dark" onclick="resetZoom()">Reset Zoom</button>
            </div>
          </div>
          </div>
          <div class="card-body p-0">
            <!-- ğŸ”¹ 3D viewer ì˜ì—­ -->
            <div id="viewer" class="w-100" style="height: 700px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ”¹ í•„ìš” ì‹œ ì—¬ê¸°ì— ì˜¤ë¥¸ìª½ col-md-4 ë‚´ìš© ì¶”ê°€ ê°€ëŠ¥ -->
    <!-- <div class="col-md-4">...</div> -->

  </div>
</div>


<script>
  const viewer = $3Dmol.createViewer("viewer", { backgroundColor: "white" });

  const pdbModels = {
    origin: `{{ origin_pdb|safe }}`,
    openfold: `{{ openfold_pdb|safe }}`,
    af2: `{{ af2_pdb|safe }}`,
    esmfold: `{{ esmfold_pdb|safe }}`,
    boltz: `{{ boltz_pdb|safe }}`,
    chai: `{{ chai_pdb|safe }}`
  };
  
  const poseColors = {
    origin: "white",
    openfold: "red",
    af2: "blue",
    esmfold: "green",
    boltz: "orange",
    chai: "purple"
  };
  
  function togglePose(button) {
    // í† ê¸€ active í´ë˜ìŠ¤
    button.classList.toggle("active");
    button.classList.toggle("btn-outline-primary");
    button.classList.toggle("btn-primary");
    
    loadSelectedPoses();
  }
  
  function loadSelectedPoses() {
    viewer.removeAllModels();
  
    const activeButtons = document.querySelectorAll('[data-pose].active');
  
    activeButtons.forEach(btn => {
      const pose = btn.getAttribute("data-pose");
      const model = viewer.addModel(pdbModels[pose], "pdb");
      model.setStyle({ cartoon: { color: poseColors[pose] } });
    });
  
    viewer.zoomTo();
    viewer.render();
  }
  
  // í˜ì´ì§€ ë¡œë“œì‹œ OpenFoldë§Œ ê¸°ë³¸ ì„ íƒ
  document.addEventListener("DOMContentLoaded", () => {
    const defaultBtn = document.querySelector('[data-pose="origin"]');
    defaultBtn.classList.add("active", "btn-primary");
    defaultBtn.classList.remove("btn-outline-primary");
    loadSelectedPoses();
  });

  function setStyleCartoon() {
    viewer.setStyle({}, { cartoon: { color: "white" } });
    viewer.render();
  }

  function resetStyleCartoon() {
    viewer.setStyle({}, { cartoon: { color: "spectrum" } });
    viewer.render();
  }

  function setStyleStick() {
    viewer.setStyle({}, { stick: { radius: 0.3 } });
    viewer.render();
  }

  let isSpinning = false;
  function toggleSpin() {
    isSpinning = !isSpinning;
    viewer.spin(isSpinning);  // â† ì´ê²ƒë§Œ ì‚¬ìš©!
  }

  function resetZoom() {
    viewer.zoomTo();
    viewer.render();
  }
</script>

{% endblock %}
